<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="mb-0">Attendance History</h3> 
    <button class="btn btn-primary btn-md" *ngIf="selectedSubordinate" (click)="myattendance()">My Attendance</button> 
  </div>

    <form #form="ngForm"  (ngSubmit)="onSubmit()">
      <div class="row justify-content-center">
        <div class="col-md-3 mb-3">
          <div class="form-group">
            <ng-select
              id="year"
              name="year"
              [items]="years"
              bindLabel="year"
              placeholder="Select year"
              [(ngModel)]="selectedYear"
              #year="ngModel"
              required
              [ngClass]="{'is-invalid': year?.invalid && year?.touched}">
            </ng-select>
            <div *ngIf="year?.invalid && year?.touched" class="invalid-feedback">
              <small class="text-danger">Year is required</small>
            </div>
          </div>
        </div>
  
        <div class="col-md-3 mb-3">
          <div class="form-group">
            <ng-select
              id="month"
              name="month"
              [items]="months"
              bindLabel="name"
              bindValue="id"
              placeholder="Select month"
              [(ngModel)]="selectedMonth"
              #month="ngModel"
              required
              [ngClass]="{'is-invalid': month?.invalid || month?.touched}">
            </ng-select>
            <div *ngIf="month?.invalid && month?.touched" class="invalid-feedback">
              <div class="text-danger">Month is required</div>
            </div>
          </div>
        </div>
  
        <div class="col-md-3 mb-3">
          <div class="form-group">
            <ng-select
              id="status"
              name="status"
              [items]="status"
              bindLabel="name"
              bindValue="id"
              placeholder="Select Attendance Status"
              [(ngModel)]="selectedStatus">
            </ng-select>
          </div>
        </div>
      
     <div class="col-md-3 mb-3">
        <p-treeSelect 
        class="sizes"
        name="status"
        [(ngModel)]="selectedSubordinate" 
        [options]="currentSubordinates" 
        placeholder="Select Subordinate"
        [filter]="true" 
        [filterInputAutoFocus]="true" />
    </div>
        <div class="col-md-3 mb-3">
          <button type="submit" class="btn btn-primary w-50" [disabled]="form.invalid">Submit</button>
        </div>
      </div>
    </form>
  
    <table class="table table-bordered ">
      <thead>
        <tr>
          <th>Date</th>
          <th>ArrivalTime</th>
          <th>DepartureTime</th>
          <th>InsideDuration</th>
          <th>OutsideDuration</th>
          <th>MissedPunch</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngIf="noRecordFound">
          <td colspan="7" style="text-align: center; color: #888; font-weight: bold;">
            No record found
          </td>
        </tr>
        <tr *ngFor="let element of attendanceData">
          <td>{{ element.date }}</td>
          <td>{{element.arrivalTime | date: 'HH:mm ':'UTC'}}</td>
          <td>{{element.departureTime | date : 'HH:mm  ':'UTC'}}</td>
          <td>{{element.insideDuration | durationFormat}} </td>
          <td>{{element.outsideDuration |durationFormat }}</td>
          <td>
            <div *ngFor="let punch of element.missedPunch|splitComma">
              {{punch}}
          </div>
        </td>
        <td class="bold-status" [ngClass]="getStatusClass(element.attendanceStatusId)">
          {{ getStatusName(element.attendanceStatusId) }}
        </td>        
        </tr>
      </tbody>
    </table>
  
    <mat-paginator [length]="totalPages"
                   [pageSize]="selectedPageSize"
                   [pageSizeOptions]="pageSizes"
                   (page)="onPageChange($event)">
    </mat-paginator>
  </div>
  